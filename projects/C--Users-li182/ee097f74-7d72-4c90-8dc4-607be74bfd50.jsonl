{"type":"summary","summary":"Unity开发规范配置添加完成","leafUuid":"7a72e2b9-8345-443a-a145-9bb57382167f"}
{"type":"summary","summary":"Code Workflow: Plan, Test, Diff, Rollback","leafUuid":"eea10b74-e7d1-4739-81db-acd0c7a06dd3"}
{"type":"file-history-snapshot","messageId":"142abcfd-f749-4fe8-8ee4-d29a9db4671b","snapshot":{"messageId":"142abcfd-f749-4fe8-8ee4-d29a9db4671b","trackedFileBackups":{},"timestamp":"2025-12-25T07:26:43.233Z"},"isSnapshotUpdate":false}
{"parentUuid":null,"isSidechain":false,"userType":"external","cwd":"C:\\Users\\li182","sessionId":"ee097f74-7d72-4c90-8dc4-607be74bfd50","version":"2.0.69","gitBranch":"","type":"user","message":{"role":"user","content":"给我一份 通用的 Unity CLAUDE.md"},"uuid":"142abcfd-f749-4fe8-8ee4-d29a9db4671b","timestamp":"2025-12-25T07:26:43.229Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"142abcfd-f749-4fe8-8ee4-d29a9db4671b","isSidechain":false,"userType":"external","cwd":"C:\\Users\\li182","sessionId":"ee097f74-7d72-4c90-8dc4-607be74bfd50","version":"2.0.69","gitBranch":"","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01UHmPvJJdBNzRsKxDVCXY7W","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"用户要求我提供一份通用的 Unity CLAUDE.md 文件。根据用户的全局指令，我需要：\n1. 使用简体中文回答\n2. 修改代码前先写计划并解释原因\n3. 修改后要跑测试\n4. 修改后要给出 diff 和回退功能\n\n但是现在用户只是要我提供一个通用的 CLAUDE.md 文件模板，这不涉及代码修改，所以我直接回答即可。\n\n用户当前的 CLAUDE.md 已经包含了很多 Unity 开发规范，我应该基于此创建一个更通用、更完善的版本。","signature":"EqwFCkYICxgCKkAHDgPwc705GiXU1G4VRTvfCP2+1iQw+DTXilHaUNIE7s9SylNptEugG40mnp9HCvZ2Il6jrI7VTCT+kMbAo7j9Egy8cCNLIv2PparNLtQaDOOPhD7pkQUoYRf87CIwHsaq12AdHxSSWBHVUqievLncfdnuT9Kb3JRIsVuL+jQActcV7DEsQGIUwpOaFGZBKpME1eW34yUyT5Ob2hm7RhApR7tRHWSMb5gOlVZEMQgZxziKroy/Txo39UtRAUU03s0C6baqofHbkBvn8RSpjK7YwY6FkmRjy+32E05wjS7JWmDci6Z+orvQo9P51lvoQyD5IZtO9/1mdLlo8to3CYruuVWW8HnxqL/NKY/uPG5MTqrIg1AQm4HzsA737f47+VxfXrFUBPY0VipFERsRLU1I7fH+pvBIblILhvmUaM7uWL67WbhhDZC9WSMCg1+o6GT7d79yTVj47zvEv4CwxHh/sWs/lUABsaFypsvfbP7vh1qJ44rI0GsqxI/WKXwctEbx+AOuLmoKmpP2JFtVVsbhu4aL2mUHPFmt859+uzpVW/ohTcxIrjGnou3z9p3gb1vcsYLVLIHNRwjLPna5M2QtUHR3lnYwdfiDEPdK6VRLqKjLFJiXHxqI4kBD6hY0xZ6XX8k2/IHJnHlSg3fudF/IGGj8/c/Uyb7xEc06Nvlbinhbisyr/+qe+qL9tJzCOZKz9XSQA0ov4WJZtQN/gG94s87ZV18TlzqUFqupfcz1fB79oq/TYPE5N0xNz5OZ6XjTLpBS87x4+xoBXQug6F8qtGynlPNGsn4ECe/JFV3zLPAzCWD58iQx0OxEhU5y3QDZ+KvaDzdf+DYk7ypZADhIt133mTbbecLB+lIsOefczaim7ueZ6ZIeBffsvN2+fNKHjVSbGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":9,"cache_creation_input_tokens":44166,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":44166,"ephemeral_1h_input_tokens":0},"output_tokens":6,"service_tier":"standard"}},"type":"assistant","uuid":"e54dd0e8-1cc5-4a80-b16f-eff0a9dca0d0","timestamp":"2025-12-25T07:26:55.846Z"}
{"parentUuid":"e54dd0e8-1cc5-4a80-b16f-eff0a9dca0d0","isSidechain":false,"userType":"external","cwd":"C:\\Users\\li182","sessionId":"ee097f74-7d72-4c90-8dc4-607be74bfd50","version":"2.0.69","gitBranch":"","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01UHmPvJJdBNzRsKxDVCXY7W","type":"message","role":"assistant","content":[{"type":"text","text":"我来为您提供一份通用的 Unity CLAUDE.md 模板，您可以根据项目需求进行调整：\n\n```markdown\n# Unity 项目开发规范\n\n## 基本要求\n- 所有回答使用简体中文\n- 修改代码前必须先制定计划并说明原因，等待确认后再执行\n- 每次代码修改后自动运行测试\n- 提供代码 diff 对比（代码级和功能级）及回退方案\n- 分步骤执行修改，每步等待确认\n\n## 架构设计原则\n\n### 代码架构\n- **设计模式**：优先使用 MVC/MVP 架构，分离数据、逻辑和视图层\n- **单一职责**：每个类只负责一个明确的功能模块\n- **解耦设计**：业务逻辑与 Unity API 解耦，提高可测试性\n- **接口抽象**：使用接口和抽象类提升扩展性和可维护性\n- **依赖管理**：Manager 类使用单例模式、依赖注入或 ScriptableObject\n\n### 代码质量标准\n- **复杂度控制**：逻辑嵌套不超过 3 层\n- **方法长度**：单个方法不超过 50 行，复杂逻辑拆分为小方法\n- **模块化组织**：相关功能的类放在同一命名空间和文件夹\n- **代码自解释**：优先通过良好命名减少注释需求\n\n## C# 编码规范\n\n### 命名约定\n```csharp\n// 类名、结构体、枚举 - PascalCase\npublic class PlayerController { }\npublic struct GameData { }\npublic enum GameState { }\n\n// 接口 - I + PascalCase\npublic interface IGameService { }\n\n// 方法、属性、事件 - PascalCase\npublic void StartGame() { }\npublic int MaxHealth { get; set; }\npublic event Action OnGameStart;\n\n// 私有字段 - _camelCase 或 camelCase\nprivate int _currentScore;\nprivate Transform cachedTransform;\n\n// 参数、局部变量 - camelCase\npublic void SetHealth(int newHealth) { }\n\n// 常量 - PascalCase 或 UPPER_CASE\nprivate const int MaxPlayers = 4;\nprivate const string PLAYER_TAG = \"Player\";\n\n// 序列化字段 - SerializeField + camelCase/PascalCase\n[SerializeField] private float moveSpeed;\n```\n\n### MonoBehaviour 规范\n```csharp\npublic class ExampleBehaviour : MonoBehaviour\n{\n    #region Serialized Fields\n    [SerializeField] private float speed = 5f;\n    [SerializeField] private GameObject targetPrefab;\n    #endregion\n\n    #region Private Fields\n    private Rigidbody _rigidbody;\n    private bool _isInitialized;\n    #endregion\n\n    #region Unity Lifecycle\n    /// <summary>\n    /// 组件初始化，获取引用\n    /// </summary>\n    private void Awake()\n    {\n        _rigidbody = GetComponent<Rigidbody>();\n    }\n\n    /// <summary>\n    /// 游戏开始时的初始化逻辑\n    /// </summary>\n    private void Start()\n    {\n        Initialize();\n    }\n\n    /// <summary>\n    /// 每帧更新 - 避免重度计算\n    /// </summary>\n    private void Update()\n    {\n        // 使用事件驱动代替高频轮询\n    }\n\n    /// <summary>\n    /// 清理资源\n    /// </summary>\n    private void OnDestroy()\n    {\n        // 取消订阅事件，停止协程\n    }\n    #endregion\n\n    #region Public Methods\n    /// <summary>\n    /// 初始化对象\n    /// </summary>\n    public void Initialize()\n    {\n        _isInitialized = true;\n    }\n    #endregion\n\n    #region Private Methods\n    private void ProcessLogic()\n    {\n        // 业务逻辑\n    }\n    #endregion\n}\n```\n\n### 性能最佳实践\n```csharp\n// ✅ 好的做法\npublic class OptimizedController : MonoBehaviour\n{\n    private Transform _transform;\n    private Rigidbody _rigidbody;\n    private const string ENEMY_TAG = \"Enemy\";\n\n    private void Awake()\n    {\n        // 缓存常用组件\n        _transform = transform;\n        _rigidbody = GetComponent<Rigidbody>();\n    }\n\n    private void OnTriggerEnter(Collider other)\n    {\n        // 使用 CompareTag\n        if (other.CompareTag(ENEMY_TAG))\n        {\n            HandleEnemyCollision(other);\n        }\n    }\n\n    // 使用对象池\n    private void SpawnProjectile()\n    {\n        var projectile = ObjectPool.Get(projectilePrefab);\n    }\n}\n\n// ❌ 避免的做法\npublic class UnoptimizedController : MonoBehaviour\n{\n    private void Update()\n    {\n        // ❌ 每帧查找对象\n        GameObject enemy = GameObject.Find(\"Enemy\");\n        \n        // ❌ 每帧获取组件\n        Rigidbody rb = GetComponent<Rigidbody>();\n        \n        // ❌ 字符串比较\n        if (gameObject.tag == \"Player\") { }\n        \n        // ❌ 频繁实例化\n        Instantiate(bulletPrefab);\n    }\n}\n```\n\n## 注释规范\n\n### XML 文档注释\n```csharp\n/// <summary>\n/// 玩家控制器，负责处理玩家移动和交互\n/// </summary>\npublic class PlayerController : MonoBehaviour\n{\n    /// <summary>\n    /// 设置玩家生命值\n    /// </summary>\n    /// <param name=\"health\">生命值，范围 0-100</param>\n    /// <returns>是否设置成功</returns>\n    public bool SetHealth(int health)\n    {\n        // 参数验证\n        if (health < 0 || health > 100)\n        {\n            return false;\n        }\n        \n        // TODO: 添加生命值变化事件通知\n        currentHealth = health;\n        return true;\n    }\n}\n```\n\n### 注释准则\n- ✅ 必须注释：公共 API、复杂算法、业务逻辑、魔法数字\n- ✅ 使用简体中文，保持简洁\n- ✅ 标记使用：TODO（待完成）、FIXME（需修复）、HACK（临时方案）、NOTE（重要说明）\n- ❌ 避免：无意义注释、注释显而易见的代码\n\n## Unity 项目结构\n\n```\nAssets/\n├── Scenes/                 # 场景文件\n│   ├── Main.unity\n│   └── Level01.unity\n├── Scripts/                # 代码文件\n│   ├── Core/              # 核心系统\n│   ├── Gameplay/          # 游戏玩法\n│   ├── Managers/          # 管理器\n│   ├── UI/                # UI 相关\n│   ├── Utils/             # 工具类\n│   ├── Data/              # 数据模型\n│   └── Editor/            # 编辑器扩展\n├── Prefabs/               # 预制体\n│   ├── Characters/\n│   ├── UI/\n│   └── Effects/\n├── Materials/             # 材质\n├── Textures/              # 贴图\n├── Audio/                 # 音频\n│   ├── Music/\n│   └── SFX/\n├── Animations/            # 动画\n├── Resources/             # 运行时加载资源\n├── StreamingAssets/       # 流式资源\n├── Plugins/               # 第三方插件\n└── Settings/              # 项目设置\n```\n\n## 性能优化清单\n\n### 对象管理\n- ✅ 频繁创建的对象使用对象池\n- ✅ 缓存 GetComponent 结果\n- ✅ 使用对象禁用代替销毁（适用场景）\n- ❌ 避免在 Update/FixedUpdate 中使用 Find/FindObjectOfType\n\n### 内存优化\n- ✅ 协程结束时正确清理（StopCoroutine）\n- ✅ 事件订阅后必须取消订阅\n- ✅ 字符串拼接使用 StringBuilder\n- ❌ 避免在循环中创建新对象\n\n### 渲染优化\n- ✅ 合并材质减少 Draw Call\n- ✅ 使用静态批处理和动态批处理\n- ✅ UGUI 优化：Canvas 分层，避免频繁重建\n- ✅ 使用 Profiler 分析渲染瓶颈\n- ❌ 删除空的 Unity 事件方法（Update、FixedUpdate 等）\n\n### 代码优化\n```csharp\n// ✅ 优化示例\nprivate StringBuilder _stringBuilder = new StringBuilder();\n\nprivate void BuildMessage()\n{\n    _stringBuilder.Clear();\n    _stringBuilder.Append(\"Score: \");\n    _stringBuilder.Append(score);\n    return _stringBuilder.ToString();\n}\n\n// 协程正确清理\nprivate Coroutine _currentCoroutine;\n\nprivate void StartSequence()\n{\n    if (_currentCoroutine != null)\n    {\n        StopCoroutine(_currentCoroutine);\n    }\n    _currentCoroutine = StartCoroutine(SequenceCoroutine());\n}\n```\n\n## 测试与调试流程\n\n### 修改前\n1. 保存当前场景\n2. 使用 `get_scene_view_screenshot` 记录初始状态\n3. 使用 `get_unity_logs` 检查现有错误\n\n### 修改中\n1. 制定详细计划并说明原因\n2. 等待用户确认\n3. 分步骤执行修改\n4. 每步完成后等待确认\n\n### 修改后\n1. 运行 Play Mode 测试\n2. 检查 Console 警告和错误\n3. 使用 Profiler 分析性能影响\n4. 提供完整 diff：\n   - 代码级对比（文件变更）\n   - 功能级对比（行为变化）\n5. 提供回退方案\n\n## 错误记录规范\n\n### 错误文档化\n- 在项目根目录创建 `ReportError/` 文件夹\n- 每个错误创建独立的 Markdown 文件\n- 文件命名：`YYYY-MM-DD-错误简述.md`\n\n### 错误报告模板\n```markdown\n# 错误报告：[简短描述]\n\n## 错误信息\n[具体错误信息]\n\n## 发生场景\n[什么操作导致的错误]\n\n## 根本原因\n[分析错误原因]\n\n## 解决方案\n[如何修复]\n\n## 预防措施\n[如何避免再次发生]\n\n## 相关文件\n- 文件路径 1\n- 文件路径 2\n```\n\n## Unity MCP 工具使用\n\n### 场景操作\n- 修改场景前先使用 `save_scene`\n- 使用 `get_unity_editor_state` 获取当前状态\n- 使用 `list_game_objects_in_hierarchy` 查看层级结构\n\n### 对象操作\n- 使用 `create_gameobject` 创建对象\n- 使用 `set_transform` 设置变换\n- 使用 `add_component` 添加组件\n- 使用 `set_property` 修改属性\n\n### 调试工具\n- `get_unity_logs` - 查看运行时日志\n- `get_scene_view_screenshot` - 截取场景视图\n- `capture_ui_canvas` - 截取 UI Canvas\n- `check_compile_errors` - 检查编译错误\n\n## Git 工作流（可选）\n\n### 提交规范\n```\nfeat: 添加新功能\nfix: 修复 Bug\ndocs: 文档更新\nstyle: 代码格式调整\nrefactor: 重构代码\nperf: 性能优化\ntest: 测试相关\nchore: 构建/工具链更新\n```\n\n### 分支策略\n- `main` - 稳定版本\n- `develop` - 开发分支\n- `feature/功能名` - 功能开发\n- `hotfix/修复名` - 紧急修复\n\n## 项目特定配置\n\n### Unity 版本\n- Unity 版本：[填写项目使用的 Unity 版本]\n- 渲染管线：[Built-in / URP / HDRP]\n- 目标平台：[PC / Mobile / Console]\n\n### 第三方插件\n- [列出项目使用的主要插件]\n\n### 团队约定\n- [团队特定的开发规范]\n- [代码审查要求]\n- [发布流程]\n\n---\n\n## 快速检查清单\n\n代码提交前检查：\n- [ ] 代码符合命名规范\n- [ ] 添加了必要的注释\n- [ ] 没有编译错误和警告\n- [ ] 通过 Play Mode 测试\n- [ ] 性能无明显下降（Profiler 验证）\n- [ ] 已保存场景和预制体修改\n- [ ] 提供了 diff 和回退方案\n- [ ] 记录了新的错误（如有）\n```\n\n这份模板涵盖了 Unity 开发的主要规范，您可以根据具体项目需求进行调整：\n\n**建议定制的部分：**\n1. **Unity 版本和渲染管线** - 填写项目具体配置\n2. **项目结构** - 根据实际项目调整文件夹组织\n3. **第三方插件** - 列出项目使用的插件和版本\n4. **团队约定** - 添加团队特定的规范\n\n您想要我帮您针对特定项目类型（如移动游戏、VR 项目、2D 游戏等）定制这份文档吗?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":9,"cache_creation_input_tokens":44166,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":44166,"ephemeral_1h_input_tokens":0},"output_tokens":4164,"service_tier":"standard"}},"type":"assistant","uuid":"44095d77-d183-48e7-9c03-d9c3ced658c2","timestamp":"2025-12-25T07:27:52.854Z"}
{"type":"file-history-snapshot","messageId":"6fdf009a-812f-417e-9074-cc92dbd5359c","snapshot":{"messageId":"6fdf009a-812f-417e-9074-cc92dbd5359c","trackedFileBackups":{},"timestamp":"2025-12-25T07:34:55.900Z"},"isSnapshotUpdate":false}
{"parentUuid":"44095d77-d183-48e7-9c03-d9c3ced658c2","isSidechain":false,"userType":"external","cwd":"C:\\Users\\li182","sessionId":"ee097f74-7d72-4c90-8dc4-607be74bfd50","version":"2.0.69","gitBranch":"","type":"user","message":{"role":"user","content":"除了Unity项目部分 其他都可以"},"uuid":"6fdf009a-812f-417e-9074-cc92dbd5359c","timestamp":"2025-12-25T07:34:55.898Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]},"todos":[]}
{"parentUuid":"6fdf009a-812f-417e-9074-cc92dbd5359c","isSidechain":false,"userType":"external","cwd":"C:\\Users\\li182","sessionId":"ee097f74-7d72-4c90-8dc4-607be74bfd50","version":"2.0.69","gitBranch":"","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01SeAduhCFzAX9wp6W7XwTaF","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"用户想要一份通用的 CLAUDE.md，但不包含 Unity 项目特定的部分。我需要提取出通用的开发规范，适用于各种项目类型。\n\n需要包含的通用部分：\n1. 基本工作流程要求（计划-确认-执行-测试-diff）\n2. 通用架构设计原则\n3. 通用代码质量标准\n4. 注释规范\n5. 性能优化通用原则\n6. 测试与调试流程\n7. 错误记录规范\n8. Git 工作流\n9. 通用项目结构建议\n\n需要移除的部分：\n- Unity 特定的代码规范\n- MonoBehaviour 相关内容\n- Unity MCP 工具使用\n- Unity 项目结构\n- Unity 性能优化细节","signature":"EoAGCkYICxgCKkDJbaRygwZhXo0RXGBofHYz+INy812pfD+ebk9s9sF4JnWvhstbhaIwatZgq5OXe62eKetIhRqjuZRoj7J/ULM4EgzL+f1hdAcsAtCP7KcaDOH3Ii0DeTW6/eu+zCIwnAdD+h02V8TcvnlODuOHxy0cgzPKwxXrwFkBK3az2XMmjr27ITG6ka1644x6R4lVKucEcc6PkfPjWT4Bax91XKNPNSClMgRm5XWufhFv/4UisvxkVUfIOVAJ4KtYREniC8v0UMsLW6ubFlaBG0vKC3nV/XAPIbEeXhvql7Jbi1dPJJgzEgvQGAgpbmtE+sFnCmmSPmzyIB6a66OPG8+OynhfvechXu1yrK1iUUl7u9uvxn4BZRQ82b6VRmX/pCFA4zyLVZH6Q6p2lqqQSgfrg0z89yr//HJPYpZ/+OMNeSdrN4npdaoR9OG54BFbaWG6TuiMktDt2sWjZDKBvDWLWKf6PNR4z1//YsI7zPylg+1/7G5+2e22JyPP2i9Y9xFfXuonovyS+UWae3SIk90FeVSUt1FEn3DqGuyiiUPX6kG+rCHHoHW3tMhlrtnjvUBD+A+3K75g76mpn0zvLw0fOcSg2cpO07/+HapC033Y5w9Vz0DQzJL2zJBDDwbWJKc5KBiSce3CKv1oNYiPWY0FKpCayZrgUYO7ZSg+KcvgN+zyfr/SLlFWC/OHZAnHJTMS4gUDU5jGbNT7ibVaU9fRoyljwSxNVRl+eSIvZgWZdCZf1tUpf9VzMnx4B7h0YnDdfWGNLCMkLiYEROCfm4N/SliOCuvm93C8//bge/5+QliPvSluSJvPXf/ikK+TIaCP0EQmV4AWEcjfiMr+SmEC5CuWGNU4eHEe8Iw+aGBGXJ9hvIxQvhJ2HBm8uv5lYlqrkqCcdlUSQRv+rw1HG+UwJFD9TTpMd74hif5OsFMEbko3ZAWjSriEcGdhtUBDCG2DSzJX22a7qgJD0N5Sy8RCOXRVGc7k7KhpOdQ7kqek5qkrSCREsP97lzD1GAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":9,"cache_creation_input_tokens":48147,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":48147,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"type":"assistant","uuid":"73c785c7-de6f-4d3f-82c1-e9c033b02373","timestamp":"2025-12-25T07:35:08.140Z"}
{"parentUuid":"73c785c7-de6f-4d3f-82c1-e9c033b02373","isSidechain":false,"userType":"external","cwd":"C:\\Users\\li182","sessionId":"ee097f74-7d72-4c90-8dc4-607be74bfd50","version":"2.0.69","gitBranch":"","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01SeAduhCFzAX9wp6W7XwTaF","type":"message","role":"assistant","content":[{"type":"text","text":"我来为您提供一份通用的 CLAUDE.md 模板，适用于各类软件开发项目：\n\n```markdown\n# 项目开发规范\n\n## 基本工作流程\n- 所有回答使用简体中文\n- **修改代码前必须先制定计划并说明原因，等待确认后再执行**\n- 每次代码修改后自动运行测试\n- 提供代码 diff 对比（代码级和功能级）及回退方案\n- 分步骤执行修改，每步等待确认\n\n## 架构设计原则\n\n### 代码架构\n- **设计模式**：根据项目特点选择合适的架构模式（MVC、MVVM、Clean Architecture 等）\n- **单一职责**：每个类/模块只负责一个明确的功能\n- **开闭原则**：对扩展开放，对修改关闭\n- **依赖倒置**：依赖抽象而非具体实现\n- **接口隔离**：接口应该小而专注，避免臃肿接口\n- **解耦设计**：降低模块间耦合度，提高可测试性和可维护性\n\n### 代码质量标准\n- **复杂度控制**：\n  - 逻辑嵌套不超过 3-4 层\n  - 圈复杂度保持在合理范围（建议 < 10）\n- **方法长度**：单个方法不超过 50 行，复杂逻辑拆分为小方法\n- **类的大小**：单个类不超过 300-500 行\n- **模块化组织**：相关功能的代码放在同一模块/包/命名空间\n- **代码自解释**：优先通过良好命名和结构减少注释需求\n- **DRY 原则**：不要重复自己，提取公共逻辑\n- **KISS 原则**：保持简单，避免过度设计\n\n## 命名规范\n\n### 通用命名原则\n- **清晰明确**：名称应该清楚表达意图\n- **避免缩写**：除非是广为人知的缩写（如 HTTP、URL）\n- **使用领域术语**：使用业务领域的专业术语\n- **长度适中**：避免过长或过短的命名\n\n### 各语言命名示例\n\n#### Python\n```python\n# 类名 - PascalCase\nclass UserManager:\n    pass\n\n# 函数、方法、变量 - snake_case\ndef calculate_total_price(item_count, unit_price):\n    total_amount = item_count * unit_price\n    return total_amount\n\n# 常量 - UPPER_SNAKE_CASE\nMAX_RETRY_COUNT = 3\nDEFAULT_TIMEOUT = 30\n\n# 私有成员 - 前缀单下划线\nclass Config:\n    def __init__(self):\n        self._internal_state = {}\n```\n\n#### JavaScript/TypeScript\n```javascript\n// 类名 - PascalCase\nclass UserService {\n    // 私有字段 - 前缀 # 或 _\n    #privateField;\n    _internalCache;\n    \n    // 方法 - camelCase\n    async fetchUserData(userId) {\n        // 常量 - UPPER_SNAKE_CASE 或 camelCase\n        const MAX_ATTEMPTS = 3;\n        const defaultTimeout = 5000;\n    }\n}\n\n// 接口/类型 - PascalCase\ninterface UserProfile {\n    userId: string;\n    userName: string;\n}\n```\n\n#### Java/C#\n```java\n// 类名、接口 - PascalCase\npublic class DataProcessor implements IProcessor {\n    // 常量 - UPPER_SNAKE_CASE\n    private static final int MAX_BUFFER_SIZE = 1024;\n    \n    // 私有字段 - camelCase 或 _camelCase\n    private String connectionString;\n    private int _retryCount;\n    \n    // 方法 - camelCase (Java) 或 PascalCase (C#)\n    public void processData(String input) {\n        // 局部变量 - camelCase\n        int resultCount = 0;\n    }\n}\n```\n\n## 注释规范\n\n### 注释准则\n- ✅ **必须注释的内容**：\n  - 公共 API 和接口\n  - 复杂算法和业务逻辑\n  - 非显而易见的设计决策\n  - 临时解决方案和技术债\n  - 参数范围、前置条件、副作用\n  \n- ❌ **避免注释的内容**：\n  - 显而易见的代码\n  - 重复代码的信息\n  - 过时的注释（及时更新或删除）\n\n### 文档注释示例\n\n#### Python (docstring)\n```python\ndef calculate_discount(price: float, discount_rate: float) -> float:\n    \"\"\"\n    计算折扣后的价格\n    \n    Args:\n        price: 原价，必须 > 0\n        discount_rate: 折扣率，范围 0.0-1.0\n        \n    Returns:\n        折扣后的价格\n        \n    Raises:\n        ValueError: 当参数不在有效范围时\n        \n    Example:\n        >>> calculate_discount(100, 0.2)\n        80.0\n    \"\"\"\n    if price <= 0 or not 0 <= discount_rate <= 1:\n        raise ValueError(\"参数超出有效范围\")\n    \n    # 应用折扣并保留两位小数\n    return round(price * (1 - discount_rate), 2)\n```\n\n#### JavaScript (JSDoc)\n```javascript\n/**\n * 用户认证服务\n * @class\n */\nclass AuthService {\n    /**\n     * 验证用户凭证\n     * @param {string} username - 用户名\n     * @param {string} password - 密码\n     * @returns {Promise<User>} 认证成功返回用户对象\n     * @throws {AuthError} 认证失败时抛出\n     */\n    async authenticate(username, password) {\n        // TODO: 添加多因素认证支持\n        // FIXME: 密码加密方式需要升级\n    }\n}\n```\n\n#### Java/C# (JavaDoc/XML Doc)\n```java\n/**\n * 数据处理器\n * \n * @author 开发者名称\n * @version 1.0\n * @since 2024-01-01\n */\npublic class DataProcessor {\n    /**\n     * 处理输入数据\n     * \n     * @param input 输入数据，不能为 null\n     * @param options 处理选项\n     * @return 处理结果\n     * @throws IllegalArgumentException 当输入无效时\n     */\n    public Result process(String input, Options options) {\n        // NOTE: 此处使用缓存提高性能\n        // HACK: 临时方案，等待上游 API 修复\n    }\n}\n```\n\n### 特殊标记\n```\nTODO: 待完成的功能或改进\nFIXME: 需要修复的问题\nHACK: 不优雅但有效的临时方案\nNOTE: 重要说明或注意事项\nOPTIMIZE: 可以优化的地方\nDEPRECATED: 已废弃的代码\n```\n\n## 代码审查清单\n\n### 功能性\n- [ ] 代码实现了需求的全部功能\n- [ ] 边界条件和异常情况处理正确\n- [ ] 没有引入新的 bug\n- [ ] 向后兼容性（如需要）\n\n### 代码质量\n- [ ] 命名清晰、符合规范\n- [ ] 逻辑清晰，易于理解\n- [ ] 没有重复代码\n- [ ] 没有过度设计\n- [ ] 遵循项目架构和设计模式\n\n### 性能\n- [ ] 没有明显的性能问题\n- [ ] 算法复杂度合理\n- [ ] 资源使用（内存、CPU、IO）合理\n- [ ] 避免不必要的计算和数据库查询\n\n### 安全性\n- [ ] 输入验证和清理\n- [ ] SQL 注入防护\n- [ ] XSS 防护\n- [ ] 敏感数据加密\n- [ ] 权限检查\n- [ ] 安全的依赖版本\n\n### 可维护性\n- [ ] 添加了必要的注释和文档\n- [ ] 测试覆盖充分\n- [ ] 日志记录适当\n- [ ] 错误处理完善\n\n## 性能优化原则\n\n### 通用优化策略\n```python\n# ✅ 好的做法\n\n# 1. 缓存计算结果\nfrom functools import lru_cache\n\n@lru_cache(maxsize=128)\ndef expensive_calculation(n):\n    return sum(i ** 2 for i in range(n))\n\n# 2. 使用生成器减少内存占用\ndef read_large_file(filepath):\n    with open(filepath) as f:\n        for line in f:  # 逐行读取，而非一次性加载\n            yield line.strip()\n\n# 3. 批量操作代替逐个操作\n# ✅ 批量插入\ndb.bulk_insert(records)\n\n# ❌ 逐个插入\nfor record in records:\n    db.insert(record)\n\n# 4. 避免不必要的计算\n# ✅ 提前计算\nlength = len(items)\nfor i in range(length):\n    process(items[i])\n\n# ❌ 重复计算\nfor i in range(len(items)):  # 每次循环都计算 len\n    process(items[i])\n\n# 5. 使用合适的数据结构\n# ✅ 使用 set 进行成员检查 O(1)\nallowed_users = set(user_list)\nif user_id in allowed_users:\n    pass\n\n# ❌ 使用 list 进行成员检查 O(n)\nif user_id in user_list:\n    pass\n```\n\n### 数据库优化\n```sql\n-- ✅ 使用索引\nCREATE INDEX idx_user_email ON users(email);\n\n-- ✅ 避免 SELECT *\nSELECT id, name, email FROM users WHERE status = 'active';\n\n-- ✅ 使用批量操作\nINSERT INTO logs (user_id, action, timestamp) VALUES\n    (1, 'login', NOW()),\n    (2, 'logout', NOW()),\n    (3, 'update', NOW());\n\n-- ✅ 合理使用 JOIN\nSELECT u.name, o.order_date \nFROM users u\nINNER JOIN orders o ON u.id = o.user_id\nWHERE u.status = 'active';\n```\n\n### API 优化\n```python\n# ✅ 实现缓存\n@cache(ttl=300)  # 缓存 5 分钟\ndef get_user_profile(user_id):\n    return db.query(\"SELECT * FROM users WHERE id = ?\", user_id)\n\n# ✅ 使用分页\ndef list_items(page=1, page_size=20):\n    offset = (page - 1) * page_size\n    return db.query(\"SELECT * FROM items LIMIT ? OFFSET ?\", page_size, offset)\n\n# ✅ 异步处理\nimport asyncio\n\nasync def fetch_multiple_resources(urls):\n    tasks = [fetch_url(url) for url in urls]\n    return await asyncio.gather(*tasks)\n```\n\n## 测试规范\n\n### 测试层级\n```python\n# 1. 单元测试 - 测试单个函数/方法\ndef test_calculate_discount():\n    assert calculate_discount(100, 0.2) == 80.0\n    assert calculate_discount(50, 0.5) == 25.0\n    \n    with pytest.raises(ValueError):\n        calculate_discount(-100, 0.2)\n\n# 2. 集成测试 - 测试模块协作\ndef test_order_processing():\n    order = create_order(user_id=1, items=[{\"id\": 1, \"qty\": 2}])\n    payment = process_payment(order)\n    assert payment.status == \"success\"\n    assert order.status == \"completed\"\n\n# 3. 端到端测试 - 测试完整流程\ndef test_user_registration_flow():\n    response = client.post(\"/register\", data={\n        \"email\": \"test@example.com\",\n        \"password\": \"secure123\"\n    })\n    assert response.status_code == 201\n    \n    # 验证邮件已发送\n    assert email_sent(\"test@example.com\")\n```\n\n### 测试最佳实践\n- ✅ 测试命名清晰描述测试内容\n- ✅ 每个测试只测试一个功能点\n- ✅ 使用 AAA 模式：Arrange（准备）、Act（执行）、Assert（断言）\n- ✅ 测试边界条件和异常情况\n- ✅ 保持测试独立，不依赖执行顺序\n- ✅ 使用 mock/stub 隔离外部依赖\n\n## 错误处理规范\n\n### 异常处理\n```python\n# ✅ 好的异常处理\ndef read_config(filepath):\n    \"\"\"读取配置文件\"\"\"\n    try:\n        with open(filepath, 'r') as f:\n            return json.load(f)\n    except FileNotFoundError:\n        logger.error(f\"配置文件不存在: {filepath}\")\n        return get_default_config()\n    except json.JSONDecodeError as e:\n        logger.error(f\"配置文件格式错误: {e}\")\n        raise ConfigError(\"配置文件格式无效\")\n    except Exception as e:\n        logger.exception(\"读取配置时发生未知错误\")\n        raise\n\n# ❌ 避免的做法\ndef bad_error_handling():\n    try:\n        risky_operation()\n    except:  # ❌ 捕获所有异常\n        pass  # ❌ 忽略错误\n```\n\n### 错误记录规范\n在项目根目录创建 `docs/errors/` 文件夹记录重要错误\n\n**文件命名**：`YYYY-MM-DD-错误简述.md`\n\n**错误报告模板**：\n```markdown\n# 错误报告：[简短描述]\n\n## 基本信息\n- **日期**：2024-01-15\n- **严重程度**：高/中/低\n- **影响范围**：[哪些功能受影响]\n- **环境**：开发/测试/生产\n\n## 错误信息\n```\n[具体错误信息、堆栈跟踪]\n```\n\n## 重现步骤\n1. 执行操作 A\n2. 输入数据 B\n3. 观察到错误 C\n\n## 根本原因\n[详细分析错误原因]\n\n## 解决方案\n[如何修复，包括代码变更]\n\n## 预防措施\n- [ ] 添加相关测试用例\n- [ ] 更新文档\n- [ ] 代码审查重点关注类似问题\n- [ ] 其他预防措施\n\n## 相关文件\n- `src/module/file.py:123`\n- `tests/test_module.py:45`\n\n## 参考链接\n- [相关 issue/PR]\n- [参考文档]\n```\n\n## Git 工作流\n\n### 提交信息规范\n```\n<type>(<scope>): <subject>\n\n<body>\n\n<footer>\n```\n\n**Type 类型**：\n- `feat`: 新功能\n- `fix`: Bug 修复\n- `docs`: 文档更新\n- `style`: 代码格式调整（不影响功能）\n- `refactor`: 重构（既非新增功能，也非修复 bug）\n- `perf`: 性能优化\n- `test`: 测试相关\n- `chore`: 构建过程或辅助工具变动\n- `revert`: 回滚之前的提交\n\n**示例**：\n```\nfeat(auth): 添加双因素认证功能\n\n实现基于 TOTP 的双因素认证，支持：\n- Google Authenticator\n- 备用恢复码\n- 记住设备功能\n\nCloses #123\n```\n\n### 分支策略\n\n#### Git Flow\n```\nmain (master)          # 生产环境，只接受 merge\n  ├── develop           # 开发主分支\n  │   ├── feature/user-auth\n  │   ├── feature/payment\n  │   └── feature/search\n  ├── release/v1.2.0   # 发布分支\n  └── hotfix/critical-bug  # 紧急修复\n```\n\n#### GitHub Flow（简化版）\n```\nmain                   # 主分支，始终可部署\n  ├── feature/user-profile\n  ├── fix/login-error\n  └── docs/api-update\n```\n\n### 最佳实践\n- ✅ 提交前运行测试\n- ✅ 保持提交原子性（一个提交只做一件事）\n- ✅ 提交信息清晰描述改动\n- ✅ 及时推送，避免大量本地提交\n- ✅ 使用 `.gitignore` 排除无关文件\n- ✅ 代码审查后再合并到主分支\n\n## 开发流程\n\n### 新功能开发\n1. **需求确认**\n   - 明确功能需求和验收标准\n   - 评估技术可行性\n\n2. **设计阶段**\n   - 制定实现计划\n   - 设计数据模型和接口\n   - 评估性能和安全影响\n   - **等待确认后再开始编码**\n\n3. **开发阶段**\n   - 分步骤实现功能\n   - 每步完成后等待确认\n   - 编写单元测试\n   - 进行代码自审\n\n4. **测试阶段**\n   - 运行所有测试\n   - 手动测试关键流程\n   - 性能测试（如需要）\n\n5. **文档更新**\n   - 更新 API 文档\n   - 更新用户文档\n   - 记录重要决策\n\n6. **提交审查**\n   - 提供详细的代码 diff\n   - 提供功能变更说明\n   - 提供回退方案\n   - 代码审查通过后合并\n\n### Bug 修复流程\n1. **问题确认**\n   - 重现问题\n   - 记录重现步骤\n   - 确认影响范围\n\n2. **原因分析**\n   - 定位根本原因\n   - 评估影响\n\n3. **修复实施**\n   - 制定修复方案\n   - 等待确认\n   - 实施修复\n   - 添加回归测试\n\n4. **验证**\n   - 验证问题已解决\n   - 确认无副作用\n   - 运行完整测试套件\n\n5. **文档记录**\n   - 记录到 `docs/errors/` 目录\n   - 更新相关文档\n\n## 项目文档结构\n\n```\ndocs/\n├── README.md              # 项目概述\n├── CONTRIBUTING.md        # 贡献指南\n├── CHANGELOG.md           # 变更日志\n├── architecture/          # 架构文档\n│   ├── overview.md\n│   ├── database.md\n│   └── api.md\n├── guides/                # 开发指南\n│   ├── setup.md          # 环境搭建\n│   ├── development.md    # 开发指南\n│   └── deployment.md     # 部署指南\n├── api/                   # API 文档\n│   └── endpoints.md\n├── errors/                # 错误记录\n│   ├── 2024-01-15-auth-bug.md\n│   └── 2024-01-20-db-connection.md\n└── decisions/             # 架构决策记录 (ADR)\n    ├── 001-use-postgresql.md\n    └── 002-api-versioning.md\n```\n\n## 安全最佳实践\n\n### 输入验证\n```python\n# ✅ 验证和清理用户输入\ndef create_user(email, password):\n    # 验证邮箱格式\n    if not is_valid_email(email):\n        raise ValidationError(\"邮箱格式无效\")\n    \n    # 验证密码强度\n    if len(password) < 8:\n        raise ValidationError(\"密码长度至少 8 位\")\n    \n    # 转义特殊字符\n    safe_email = escape(email)\n    \n    # 使用参数化查询\n    db.execute(\n        \"INSERT INTO users (email, password) VALUES (?, ?)\",\n        safe_email, hash_password(password)\n    )\n```\n\n### 敏感信息处理\n```python\n# ✅ 环境变量存储敏感信息\nimport os\n\nDATABASE_URL = os.getenv('DATABASE_URL')\nAPI_SECRET = os.getenv('API_SECRET')\n\n# ✅ 日志中隐藏敏感信息\ndef log_request(request):\n    safe_data = {\n        'path': request.path,\n        'method': request.method,\n        # 不记录密码、token 等\n    }\n    logger.info(f\"Request: {safe_data}\")\n\n# ❌ 避免硬编码\n# DATABASE_URL = \"postgresql://user:pass@localhost/db\"\n```\n\n### 依赖安全\n```bash\n# 定期检查依赖漏洞\npip install safety\nsafety check\n\nnpm audit\nnpm audit fix\n```\n\n## 代码提交前检查清单\n\n- [ ] 代码符合命名规范\n- [ ] 添加了必要的注释和文档\n- [ ] 没有调试代码（console.log、print 等）\n- [ ] 没有硬编码的敏感信息\n- [ ] 所有测试通过\n- [ ] 代码覆盖率达标\n- [ ] 没有编译错误和警告\n- [ ] 性能无明显下降\n- [ ] 安全检查通过\n- [ ] 提供了详细的 diff（代码级和功能级）\n- [ ] 提供了回退方案\n- [ ] 更新了相关文档\n- [ ] Git 提交信息规范\n\n---\n\n## 项目特定配置\n\n### 技术栈\n- **语言**：[填写使用的编程语言]\n- **框架**：[填写使用的框架]\n- **数据库**：[填写数据库类型]\n- **部署环境**：[填写部署平台]\n\n### 团队约定\n- **代码审查**：[审查流程和要求]\n- **发布流程**：[版本发布的步骤]\n- **沟通渠道**：[团队协作工具]\n\n### 工具链\n- **版本控制**：Git + [GitHub/GitLab/Bitbucket]\n- **CI/CD**：[持续集成工具]\n- **代码质量**：[Linter、Formatter 等]\n- **测试框架**：[单元测试、集成测试框架]\n- **文档工具**：[文档生成工具]\n\n---\n\n*最后更新：[日期]*\n```\n\n这份通用模板涵盖了软件开发的核心规范，适用于大多数项目类型。您可以根据具体项目的技术栈和团队需求进行调整。\n\n**建议使用方式：**\n1. 将此文件保存为 `.claude/CLAUDE.md`（项目级）或 `~/.claude/CLAUDE.md`（全局）\n2. 根据项目实际情况填写\"项目特定配置\"部分\n3. 根据使用的编程语言调整具体的代码示例\n4. 随着项目发展持续更新和完善\n\n您需要我针对特定技术栈（如 Python Web、React 前端、Node.js 后端等）定制这份文档吗？"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":9,"cache_creation_input_tokens":48147,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":48147,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"type":"assistant","uuid":"8d1ed79f-78d4-4aea-82c1-5a7b49d4bc4a","timestamp":"2025-12-25T07:36:49.778Z"}
