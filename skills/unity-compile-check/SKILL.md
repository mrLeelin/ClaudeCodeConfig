---
name: unity-compile-check
description: Unity 编译检查助手。在修改 Unity C# 代码后自动检查编译状态，使用 Unity MCP 工具检测编译错误，提供详细的错误信息和修复建议。支持自动修复常见编译错误。
---

# Unity 编译检查 Skill

## Skill 目标

在每次修改 Unity C# 代码后自动检查编译状态，及时发现编译错误，提供详细的错误信息和修复建议，确保代码质量。

## 使用场景

### 自动触发场景
1. **代码修改后**：使用 Edit 或 Write 工具修改 Unity C# 脚本后
2. **新建脚本后**：创建新的 Unity C# 脚本后
3. **批量修改后**：完成多个文件的修改后

### 手动触发场景
1. **用户明确要求**：用户要求检查编译状态
2. **调试阶段**：需要确认代码是否可以编译
3. **提交前检查**：代码提交前的最终检查

## 执行流程

### 1. 检查 Unity 项目状态
- 确认 Unity Editor 是否正在运行
- 确认 Unity 项目根目录已设置
- 如果 Unity 未运行，提示用户启动 Unity

### 2. 等待编译完成
- Unity 检测到文件变化后会自动开始编译
- 等待 2-3 秒让 Unity 完成编译过程
- 避免在编译过程中检查状态

### 3. 检查编译状态
使用 Unity MCP 工具：
```
mcp__coplay-mcp__check_compile_errors
```

### 4. 分析编译结果

#### 情况 A：编译成功
- ✅ 显示"编译成功"消息
- 提供代码修改摘要
- 询问用户是否需要进一步操作

#### 情况 B：有编译错误
- ❌ 显示所有编译错误
- 按文件分组显示错误
- 为每个错误提供：
  - 错误类型和描述
  - 错误位置（文件名和行号）
  - 可能的原因分析
  - 修复建议

### 5. 提供修复方案
- 分析错误类型
- 提供具体的修复步骤
- 询问用户是否需要自动修复
- 如果用户同意，执行修复操作

## 常见编译错误和修复方案

### 1. 命名空间错误
**错误示例：**
```
CS0246: The type or namespace name 'XXX' could not be found
```

**可能原因：**
- 缺少 using 语句
- 命名空间拼写错误
- 缺少程序集引用

**修复方案：**
1. 检查是否缺少 using 语句
2. 添加正确的 using 语句
3. 检查命名空间是否正确

### 2. 类型不匹配错误
**错误示例：**
```
CS0029: Cannot implicitly convert type 'XXX' to 'YYY'
```

**可能原因：**
- 变量类型声明错误
- 方法返回类型不匹配
- 类型转换缺失

**修复方案：**
1. 检查变量类型声明
2. 添加显式类型转换
3. 修改方法返回类型

### 3. 方法签名错误
**错误示例：**
```
CS1501: No overload for method 'XXX' takes N arguments
```

**可能原因：**
- 方法参数数量不匹配
- 方法参数类型不匹配
- 方法名拼写错误

**修复方案：**
1. 检查方法调用的参数数量
2. 检查参数类型是否正确
3. 检查方法名是否正确

### 4. 访问修饰符错误
**错误示例：**
```
CS0122: 'XXX' is inaccessible due to its protection level
```

**可能原因：**
- 访问私有成员
- 访问内部成员
- 访问受保护成员

**修复方案：**
1. 修改成员的访问修饰符
2. 使用公共接口访问
3. 重新设计类的访问结构

### 5. 缺少分号或括号
**错误示例：**
```
CS1002: ; expected
CS1003: Syntax error, ',' expected
```

**可能原因：**
- 语句末尾缺少分号
- 括号不匹配
- 语法错误

**修复方案：**
1. 检查语句末尾是否有分号
2. 检查括号是否匹配
3. 检查语法是否正确

### 6. Unity 特定错误
**错误示例：**
```
CS0619: 'XXX' is obsolete
```

**可能原因：**
- 使用了已废弃的 Unity API
- Unity 版本不兼容

**修复方案：**
1. 查找替代的 Unity API
2. 更新代码使用新的 API
3. 检查 Unity 文档获取迁移指南

## 自动修复策略

### 可以自动修复的错误
1. **缺少 using 语句**：自动添加常用的 using 语句
2. **缺少分号**：在语句末尾自动添加分号
3. **简单的类型转换**：添加显式类型转换
4. **命名空间错误**：添加正确的 using 语句

### 需要用户确认的修复
1. **修改方法签名**：可能影响其他代码
2. **修改访问修饰符**：可能影响封装性
3. **重构代码结构**：需要用户决策

### 不建议自动修复的错误
1. **逻辑错误**：需要理解业务逻辑
2. **架构问题**：需要整体设计考虑
3. **性能问题**：需要权衡取舍

## 执行示例

### 示例 1：编译成功
```
✅ Unity 编译检查完成

编译状态：成功
修改文件：PlayerController.cs
修改内容：添加了跳跃功能

下一步建议：
1. 运行 Play Mode 测试功能
2. 检查 Console 日志
3. 继续开发其他功能
```

### 示例 2：有编译错误
```
❌ Unity 编译检查发现错误

编译状态：失败
错误数量：2 个

错误详情：

【错误 1】
文件：PlayerController.cs:45
类型：CS0246
描述：找不到类型或命名空间名称 'Rigidbody2D'
原因：缺少 using UnityEngine 语句
修复建议：在文件开头添加 using UnityEngine;

【错误 2】
文件：PlayerController.cs:67
类型：CS1002
描述：缺少分号
原因：语句末尾缺少分号
修复建议：在第 67 行末尾添加分号

是否需要自动修复这些错误？
1. 自动修复所有错误
2. 手动修复
3. 查看详细信息
```

## 集成到工作流程

### 在 CLAUDE.md 中添加规则
建议在 CLAUDE.md 的"每次必做清单"中添加：
```markdown
4. ✅ **修改后自动检查编译**：每次 Unity 代码修改完成后自动使用 unity-compile-check skill 检查编译状态
```

### 触发时机
- 每次使用 Edit 或 Write 工具修改 .cs 文件后
- 用户明确要求检查编译时
- 代码提交前的最终检查

## 注意事项

1. **等待编译完成**：Unity 需要时间检测文件变化并编译，建议等待 2-3 秒
2. **Unity 必须运行**：此 skill 需要 Unity Editor 处于运行状态
3. **项目根目录**：确保已正确设置 Unity 项目根目录
4. **自动修复风险**：自动修复可能不适用于所有情况，建议先预览修复内容
5. **保留注释**：修复错误时不要删除原有的有意义注释

## 错误处理

### Unity 未运行
```
⚠️ 无法连接到 Unity Editor

请确保：
1. Unity Editor 已启动
2. Unity 项目已打开
3. Unity MCP 服务正常运行

启动 Unity 后请重试。
```

### 项目根目录未设置
```
⚠️ Unity 项目根目录未设置

请使用以下命令设置项目根目录：
mcp__coplay-mcp__set_unity_project_root

或者提供项目路径。
```

### 编译超时
```
⚠️ 编译检查超时

可能原因：
1. Unity 正在处理大量文件
2. 编译过程较慢
3. Unity 响应异常

建议：
1. 等待 Unity 完成当前操作
2. 检查 Unity Console 是否有错误
3. 重启 Unity Editor
```

## 总结

此 skill 提供了完整的 Unity 编译检查流程，能够：
- ✅ 自动检测编译错误
- ✅ 提供详细的错误信息
- ✅ 给出具体的修复建议
- ✅ 支持自动修复常见错误
- ✅ 集成到开发工作流程

使用此 skill 可以显著提高开发效率，及时发现和修复编译错误，确保代码质量。
