---
description: 对整个项目进行全面分析和优化规划
---

# /optimize-project - 工程优化

对整个项目进行全面分析和优化规划，生成优先级优化方案。

## 用法

```
/optimize-project <project-path>
```

### 参数

- `<project-path>` - 项目根目录路径
  - 示例：`/optimize-project E:\Project\MyGame`
  - 示例：`/optimize-project .` （当前目录）

## 功能描述

对整个项目进行系统的分析和优化规划：

### 1. **项目结构分析**
   - 文件夹组织是否合理
   - 命名约定一致性
   - 依赖关系检查
   - 模块化程度评估

### 2. **性能瓶颈识别**
   - 高性能开销文件排序
   - 算法复杂度热点
   - 内存泄漏风险
   - 渲染性能问题（Unity）
   - 加载时间分析

### 3. **代码质量评分**
   - 全项目代码复杂度
   - 代码重复率
   - 测试覆盖率估算
   - 文档完整性

### 4. **规范合规性**
   - 命名约定统一性
   - 代码风格一致性
   - 注释和文档标准
   - 项目结构规范

### 5. **特定领域优化** (如适用)
   - **Unity 项目：** 渲染管线、物理优化、资源加载
   - **前端项目：** 包体大小、加载性能、渲染优化
   - **后端项目：** 数据库查询、API 响应时间、可扩展性

### 6. **安全和风险评估**
   - 依赖库过期检查
   - 安全漏洞风险
   - 代码坏味道

## 输出示例

```
### Project Optimization Analysis

#### 项目概览
- 项目名: MyGame
- 项目类型: Unity 3D
- 总文件数: 245 个
- 总代码行数: 48,320 行
- 最大单文件: 1,230 行

#### 整体评分

| 维度 | 评分 | 状态 | 优先级 |
|------|------|------|--------|
| 代码质量 | 6.5/10 | ⚠️ 需改进 | 高 |
| 性能 | 5.8/10 | ⚠️ 需优化 | 高 |
| 规范合规 | 7.2/10 | ✓ 良好 | 中 |
| 架构设计 | 6.0/10 | ⚠️ 需重构 | 高 |
| 可维护性 | 6.8/10 | ⚠️ 需改进 | 中 |
| **总体评分** | **6.5/10** | | |

---

## 优化优先级清单

### 🔴 P0 - 紧急优化 (立即处理)

#### 1. 性能瓶颈: PlayerController.cs (1,230 行)
- 问题: 单个文件超大，复杂度高
- 影响: 难以维护，性能受影响
- 建议: 拆分为 PlayerMovement、PlayerCombat、PlayerUI 三个文件
- 预期收益: 代码行数平均化，性能提升 20%

```
文件: Assets/Scripts/Player/PlayerController.cs (1,230 行)
      ├─ 移动逻辑 (450 行) → PlayerMovement.cs
      ├─ 战斗逻辑 (520 行) → PlayerCombat.cs
      └─ UI交互 (260 行) → PlayerUI.cs
```

工作量: 中等 (3-4 小时)
难度: 中等

---

#### 2. 性能问题: GameManager 中的 Update
- 问题: Update 中进行数据库查询
- 影响: 每帧额外开销，造成帧率波动
- 建议: 使用协程异步查询，缓存结果
- 预期收益: 帧率稳定性提升 40%

示例文件: Assets/Scripts/Manager/GameManager.cs (第 156-180 行)

工作量: 小 (1-2 小时)
难度: 低

---

#### 3. 内存泄漏风险: EventSystem
- 问题: 事件订阅未正确取消
- 影响: 潜在内存泄漏
- 建议: 添加 OnDestroy 中的事件取消订阅
- 预期收益: 内存占用减少 5-10%

受影响文件:
- Assets/Scripts/Manager/EventManager.cs
- Assets/Scripts/UI/*.cs (8 个文件)

工作量: 小 (2 小时)
难度: 低

---

### 🟡 P1 - 高优先级优化 (本周处理)

#### 4. 代码重复: 移动逻辑在 3 个文件中重复
文件:
- Assets/Scripts/Player/PlayerController.cs
- Assets/Scripts/Enemy/EnemyAI.cs
- Assets/Scripts/NPC/NPCController.cs

建议: 提取为 CharacterMovement 基类
预期收益: 减少 300+ 行代码，提升可维护性

工作量: 中等 (3 小时)
难度: 中等

---

#### 5. 规范不统一: 命名风格混乱
问题:
- 私有字段使用 `_camelCase` 和 `camelCase` 混合
- 方法命名有时 `GetX` 有时 `FetchX`
- 常量使用 `UPPER_CASE` 和 `PascalCase` 混合

建议:
1. 全项目统一为: 私有字段 `_camelCase`，方法 `PascalCase`，常量 `UPPER_CASE`
2. 使用自动化工具（如 Roslyn 分析器）强制执行

工作量: 中等 (4 小时，包括脚本编写)
难度: 低

---

#### 6. 缺少文档: 公共 API 未注释
- 影响范围: 约 120 个公共方法
- 建议: 批量添加 XML 文档注释
- 优先级: UI、Manager、Service 类首先处理

工作量: 中等 (4-6 小时)
难度: 低

---

### 🟢 P2 - 中优先级优化 (本月处理)

#### 7. 项目结构改进
问题: Scripts 文件夹结构不够清晰
```
当前:
Scripts/
├── Player/ (包含所有玩家相关)
├── Enemy/ (包含所有敌人相关)
├── Manager/ (混杂了不同职责)
└── UI/ (UI 脚本分散)

建议:
Scripts/
├── Gameplay/
│  ├── Player/
│  ├── Enemy/
│  ├── NPC/
│  └── Combat/
├── Managers/
│  ├── GameManager.cs
│  ├── UIManager.cs
│  └── AudioManager.cs
├── Services/
│  ├── SaveSystem/
│  ├── EventSystem/
│  └── Pool/
├── UI/
│  ├── HUD/
│  ├── Menu/
│  └── Dialogs/
└── Utils/
   └── ...
```

工作量: 大 (全天)
难度: 中等
风险: 高（需要大量引用更新）

---

### 📊 统计数据

#### 代码质量热力图

| 文件夹 | 文件数 | 代码行 | 平均复杂度 | 状态 |
|--------|--------|--------|-----------|------|
| Player | 6 | 4,250 | 8.5 | 🔴 |
| Enemy | 8 | 3,120 | 6.2 | 🟡 |
| Manager | 12 | 8,960 | 7.8 | 🔴 |
| UI | 15 | 6,840 | 5.4 | 🟡 |
| Utils | 8 | 1,920 | 3.2 | 🟢 |

---

#### 性能热点分析

| 组件 | CPU占用 | 内存占用 | 帧影响 | 改善空间 |
|------|--------|---------|--------|----------|
| 物理系统 | 18% | 45MB | 高 | 30% |
| 渲染 | 42% | 250MB | 高 | 15% |
| AI 系统 | 12% | 60MB | 中 | 40% |
| UI | 8% | 85MB | 低 | 50% |
| 数据管理 | 20% | 120MB | 中 | 35% |

---

#### 依赖库分析

| 库 | 版本 | 状态 | 说明 |
|----|----|------|------|
| Newtonsoft.Json | 12.0.3 | ⚠️ 过期 | 建议升级到 13+ |
| UniTask | 2.2.0 | ✓ 最新 | - |
| DOTween | 1.2.0 | ⚠️ 过期 | 2.0+ 版本更好 |

---

## 实施路线图

### 第一周 (P0 任务)
- [ ] 拆分 PlayerController.cs (8h)
- [ ] 修复 GameManager Update 性能问题 (4h)
- [ ] 添加事件订阅取消 (4h)

**预期成果:** 性能提升 40%, 代码质量提升 15%

---

### 第二周 (P1 任务)
- [ ] 提取重复的移动逻辑 (6h)
- [ ] 统一命名风格 (6h)
- [ ] 补充关键 API 文档 (8h)

**预期成果:** 代码行数减少 10%, 可维护性提升 25%

---

### 第三周 (P2 任务)
- [ ] 重构项目结构 (8h)
- [ ] 更新所有引用 (6h)
- [ ] 集成自动化检查工具 (4h)

**预期成果:** 项目整体评分 8.5/10

---

## 执行建议

### 优化顺序
1. **第一阶段:** P0 紧急优化 (性能和稳定性)
2. **第二阶段:** P1 高优先级 (代码质量和规范)
3. **第三阶段:** P2 中优先级 (架构和长期维护)

### 风险缓解
- 每个优化前备份代码
- 优化后运行完整测试
- 使用 Git 分支进行开发
- 逐步提交，便于回滚

### 工具支持
- Unity Profiler - 性能分析
- Code Analysis - 代码质量
- Version Control - Git 管理
- Automated Testing - 自动化测试

---

## 相关命令

- `/review` - 审查具体文件
- `/optimize-file` - 优化单个文件
- `/optimize-folder` - 优化文件夹内的代码

## 下一步

选择优先级最高的任务，使用 `/optimize-file` 生成具体改进代码。
```

## 与其他功能的关系

- **与 `/review` 的关系：** 项目级审查
- **与 `/optimize-file` 的关系：** 针对具体文件优化
- **与 `/optimize-folder` 的关系：** 单个文件夹优化

## 常见用法

### 分析整个项目
```
/optimize-project E:\Project\MyGame
```

### 分析当前工作目录
```
/optimize-project .
```

### 获取快速总结
```
/optimize-project E:\Project\MyGame --summary
```

## 输出内容

- ✓ 整体评分和现状评估
- ✓ 优先级排序的优化清单
- ✓ 每项优化的工作量和难度估算
- ✓ 预期的性能和质量收益
- ✓ 详细的实施路线图
- ✓ 风险评估和缓解方案
- ✓ 性能热点和代码质量热力图

## 备注

- 分析基于项目的 CLAUDE.md 规范
- 对于 Unity 项目，特别关注性能和架构
- 输出可用于团队讨论和规划
- 建议定期（如每月）运行此命令跟踪进展
